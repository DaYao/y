/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 9 13:44
*/
KISSY.add("xtemplate/runtime/base",function(e){function a(c,b){this.tpl=c;b=e.merge(f,b);b.subTpls=e.merge(b.subTpls,a.subTpls);b.commands=e.merge(b.commands,a.commands);this.option=b}var f={silent:!0,name:"",utils:{getProperty:function(c,b){if("this"==c||"."==c)return b.length?[b[0]]:!1;var c=c.split("."),g=c.length,d,f,a,e,j,k=b.length;for(f=0;f<k;f++){a=b[f];j=1;for(d=0;d<g;d++){e=c[d];if("object"!=typeof a||!(e in a)){j=0;break}a=a[e]}if(j)return"function"==typeof a&&(a=a.call(b[k-1])),[a]}return!1}}};
a.prototype={constructor:a,removeSubTpl:function(c){delete this.option.subTpls[c]},removeCommand:function(c){delete this.option.commands[c]},addSubTpl:function(c,b){this.option.subTpls[c]=b},addCommand:function(c,b){this.option.commands[c]=b},render:function(c,b){b||(c=[c]);return this.tpl(c,this.option)}};return a});
KISSY.add("xtemplate/runtime/commands",function(e,a){return{each:function(a,c){var b=c.params[0],g="",d;if(b){var h=[0,0].concat(a);if(e.isArray(b)){d=b.length;for(var i=0;i<d;i++)h[0]=b[i],h[1]={xcount:d,xindex:i},g+=c.fn(h)}else for(d in b)h[0]=b[d],h[1]={xkey:d},g+=c.fn(h)}else c.inverse&&(g=c.inverse(a));return g},"with":function(a,c){var b=c.params[0],g=[0].concat(a),d="";b?(g[0]=b,d=c.fn(g)):c.inverse&&(d=c.inverse(a));return d},"if":function(a,c){var b="";c.params[0]?c.fn&&(b=c.fn(a)):c.inverse&&
(b=c.inverse(a));return b},set:function(a,c){for(var b=a.length-1;0<=b;b--)if("object"==typeof a[b]){e.mix(a[b],c.hash);break}return""},include:a.include}},{requires:["./include-command"]});
KISSY.add("xtemplate/runtime/include-command",function(e,a){var f={invokeEngine:function(c,b,g){return(new a(c,e.merge(g))).render(b,!0)},include:function(c,b){var a=b.params;if(!a||1!=a.length)return e[b.silent?"log":"error"]("include must has one param"),"";var a=a[0],d;if(!(d=b.subTpls[a]))return e[b.silent?"log":"error"]('does not include sub template "'+a+'"'),"";b.name=a;return f.invokeEngine(d,c,b)}};return f},{requires:["./base"]});
KISSY.add("xtemplate/runtime",function(e,a,f,c){a.addCommand=function(b,a){f[b]=a};a.removeCommand=function(b){delete f[b]};a.commands=f;a.includeCommand=c;var b={};a.subTpls=b;a.addSubTpl=function(a,c){b[a]=c};a.removeSubTpl=function(a){delete b[a]};return a.IncludeEngine=a},{requires:["./runtime/base","./runtime/commands","./runtime/include-command"]});
